---
description: Analyze a PR $ARGUMENT and make a user flow out of it
---

## Motivation

The goal of this work is, given a PR, to generate a video that walks through the user journey in the new feature. Say for example, something changed or added to a screen, we would like to show the user journey to there from the home page and then interacting with the elements that were changed so some team leader or product manager can grasp the change visually using a video.

## Validation & prerequisites

1. Verify that GitHub and Playwright MCP are installed. If not, quit immediately
2. Ensure that this site is accessible with Playwright MCP. If not, quit immediately
3. Verify that an argument with a link to GitHub PR was provided. If not, quit immediately

## Other resources to be aware of

1. Login - this page explains how to handle login @how-to-handle-login.md. Be sure to read this and do exactly what is described over there. Don't try anything else

## Tasks

Visit the PR that was provided as argument (use GitHub MCP).

Learn it, read the description and the code that changed. If you can't find the right view, stop early and tell why. If a pre-state (existing records) is needed, try to add this through the UI first. If you can't create the neccessary pre-state, stop early and tell why. If needed, search for a feature flag in the code and activate/deactivate it. Create a markdown file pr-user-flow-{feature-name}{timestamp}.md with only the following sections:

1. "Start the system" - Using 'npm run start:staging-new'
2. "Product change" - Describe the product change briefly
3. "Tech change" - Describe what changed technically
4. "The user flow" - Tell this PR story in a user flow format: explain how we get to the page with the "Change" (which clicks are needed from the home page). Wheneve you perform a key navigation click to the target view - add prefix 'Key click'. choose key interactions and actions that tell the change story. Each user interaction (like navigation, click, fill, form, mouse move, scroll, anything) is a step in your user flow. If some pre-state is needed, like some records/entities - explain how to create it first. Only includ steps that you could perform, don't rely on the code but rather include what was done over a real browser. Understand what is the success visual of this feature, put the word "Punch" before this step. If a new item/column/field/label was added, add a step to select this data with the mouse cursor so the viewer note this new info. Here is an example of a story:

- Visit the home page
- Key click: Click side menu to navigate to "{some route}"
- Visit the page "{some route}"
- Click on the button "{some button name}"
- Add a new {some entity} via the form in /app/route (some pre-state that is needed)
- A text box will popup on the screen (just an example)
- Fill the text "{some text}"
- Select the written the text with the mouse
- Punch: Hover the success message toast or Click on the newly added columns // The success visual of this feature
- etc

When part of the flow is showing data/entities/items, prefer adding an entity yourself even though some other entities exist. If you are able to locate a screen that allows adding these kinds of entities, then add a new one and include this in the flow. So then later on when there is an act over this entity, it is clear where it arrived from

For example, when displaying a grid or a card of information, locate a screen to add entities of this kind

5. "The punch visual" - Upon deciding what the valuable outcome of this flow is, the defines some nice text and callout to display hover the Punch visual. For example, in the case of a new validation to some fields, then the punch visual can be a callout window over the validation failure showing "now the form blocks this kind of data". Another example is new table columns - the Punch visual can show a call-out over each new column telling "a new column that was added in this PR"

6. "Verify user flow" - Try again to follow and reproduce the user flow below, could you indeed perform every step? If no, don't insist, explain why and quit
7. "Code locations" - Find in the code base here, where physically is the page path and where are the related components
8. "Navigation images" - Using Playwright MCP, visit the page perform everything you described in the user flow. Take printshots
9. "Key interactive elements" - During the walkthrough, you'll notice the key page interactive elements like links, buttons, forms, and that is needed to accomplish the flow. Let's note them down, in a table. Check whether they have ARIA attributes (e.g., aria-label, label-name), and put a selector example to this element. Only put locators that you tried yourself or explicitly see in the code! Important: Don't guess locators. Strive to pick user facing selectors like getByRole if indeed exist. If an element has no proper ARIA attribute, put ‚ùå in this row
10. "Playwright test" - Write the user flow as a single Playwright test without assertions. Later on, we will take this Playwright script and embed it in another solution that has a test runner and record the video. Consequently, it does not mean for assertion or as standard testing, rather only for video recording. No need to install anything or actually run the tests

The test should follow all the steps from the section "The user flow". Use the section "Key interactive elements" to find out how to interact with elements

IMPORTANT: Minimize timeouts, try to rely on getByRole, getByLabel and other user facing locators. Try to avoide nth locators like first(), last()

IMPORTANT: If some unrelated popup/tooltip is opened, like cookies privacy concent - close it

When writing the test, don't rely on brittle assumptions like network idle. Instead, after the locator, put a waitFor the next element that you think should appear

11. Include the punch visual in the test - Read the section 'The punch visual', include this as the final step of the test. Locate the punch visual, try putting a border around the relevant section and/or callout nearby as defined in "The punch visual". Do this by injecting some JS into the page. In the file @an-example-feature-popover.js you may see an example of how this tooltip/popover might look like. Then wait 7 seconds after the punch to let the recorder capture this

Also, whenever there is a 'key click' in the user flow, we'd like to show the click that led to the page - add a callout over the clickable element with some contextual text like "Clicking {screen name}", then wait 4 seconds

IMPORTANT: Read the file @an-example-feature-popover.js to see example

Try your punch visuals script by injecting this into the page using Playwright MCP - it should be visible in the page

12. Create a test file by copying the file @pr-flow-recorder-template.ts, name it pr-flow-recorder-{feature-name}{time-stamp}.ts. Put this test inside, keep the before each and other code inside
13. Run the tests npm run test:e2e

## Other instructions

1. Do not include any section in the report that was not explicitly requested
2. Important: ensure that you use the file @how-to-create-pr-video-callouts.md for creating borders and call-outs before navigating to the view to the target view. Open a call-out hover the clickable element and explain that you are clicking there. Check the call-outs and borders using the @playwright-mcp.mp4
